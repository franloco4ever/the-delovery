---
import productsData from "../data/paquetes.json";

const bigPacks = productsData.filter((item) => item.size == "grande");

import "swiper/css/navigation";
import "swiper/css/pagination";
---

<section>
  <div class="mb-8 flex flex-col items-center text-center">
    <h3
      class="flex items-center gap-2 text-2xl font-bold tracking-tight text-[#1d0c0e] dark:text-white sm:text-3xl"
    >
      BIG LOVE <span class="text-primary">❤️</span>
    </h3>
    <p class="text-gold font-medium">Para cuando sobran las palabras.</p>
  </div>
  <div class="swiper loveSwiper !pb-12 !px-1">
    <div class="swiper-wrapper">
      {
        bigPacks.map((el) => {
          return (
            <div class="swiper-slide">
              <div class="block group relative overflow-hidden rounded-2xl border-2 border-gold/30 bg-surface-light dark:bg-surface-dark p-1 shadow-gold hover:shadow-pop-hover transition-all">
                <div class="grid md:grid-cols-2">
                  <div class="relative h-64 md:h-auto overflow-hidden rounded-xl md:rounded-r-none">
                    <img
                      alt="Luxurious gift set with flowers and champagne"
                      class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
                      src={el.img}
                    />
                    <div class="absolute top-4 left-4 bg-gold text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">
                      Premium
                    </div>
                  </div>
                  <div class="flex flex-col justify-center p-6 md:p-8">
                    <h4 class="mb-2 text-2xl font-bold text-gray-900 dark:text-white">
                      {el.name}
                    </h4>
                    <p class="mb-6 text-gray-600 dark:text-gray-300">
                      La experiencia completa. Incluye arreglo floral grande,
                      botella de Moët &amp; Chandon, chocolates artesanales y
                      tarjeta personalizada en papel algodón.
                    </p>
                    <ul class="mb-8 space-y-2">
                      {el.content.map((i) => {
                        return (
                          <li class="flex items-center gap-3 text-sm text-gray-700 dark:text-gray-300">
                            <span class="material-symbols-outlined text-gold">
                              check_circle
                            </span>
                            {i}
                          </li>
                        );
                      })}
                    </ul>
                    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
                      <span class="text-3xl font-black text-[#1d0c0e] dark:text-white">
                        ${el.price}
                      </span>
                      <button
                        data-item-id={el.id}
                        data-item-name={el.name}
                        data-item-image={el.img}
                        data-item-price={el.price}
                        class="add-to-cart cursor-pointer flex w-full sm:w-auto items-center justify-center gap-2 rounded-xl bg-whatsapp px-8 py-3 text-base font-bold text-white shadow-lg transition-transform group-hover:-translate-y-1 group-hover:shadow-xl group-hover:bg-whatsapp-hover"
                      >
                        <span class="material-symbols-outlined">chat</span>
                        LO QUIERO
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          );
        })
      }
    </div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-next hidden sm:flex"></div>
    <div class="swiper-button-prev hidden sm:flex"></div>
  </div>
</section>
<script>
  import Swiper from "swiper";
  import { Pagination, Navigation, Autoplay } from "swiper/modules";
  import { addCartItem, isCartOpen } from "../atoms/cardStore";

  document.addEventListener("DOMContentLoaded", function () {
    // Big Love Swiper
    new Swiper(".loveSwiper", {
      modules: [Pagination, Navigation, Autoplay],
      slidesPerView: 1,
      spaceBetween: 20,
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      // Since it's a single item by default, logic allows for more if added later
    });
  });

  // Agregar event listeners a los botones
  const addToCartButtons = document.querySelectorAll(".add-to-cart");

  addToCartButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
      const btn = e.currentTarget as HTMLButtonElement;
      const itemId = btn.dataset.itemId;
      const itemName = btn.dataset.itemName;
      const itemImage = btn.dataset.itemImage;
      const itemPrice = parseFloat(btn.dataset.itemPrice || "0");

      if (itemId && itemName && itemImage) {
        addCartItem({
          id: itemId,
          name: itemName,
          imageSrc: itemImage,
          price: itemPrice,
        });

        // Opcional: Abrir el carrito automáticamente
        isCartOpen.set(true);

        // Opcional: Feedback visual
        btn.textContent = "¡AGREGADO!";
        setTimeout(() => {
          btn.innerHTML = `<span class="material-symbols-outlined text-[18px]">chat</span> LO QUIERO`;
        }, 1000);
      }
    });
  });
</script>
