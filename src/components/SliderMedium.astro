---
import { Picture } from "astro:assets";
import productsData from "../data/paquetes.json";

import "swiper/css/navigation";
import "swiper/css/pagination";

const mediumPacks = productsData.filter((item) => item.size == "mediano");

// 1. Cargamos todas las imágenes de la carpeta de forma dinámica
const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/img_packages/*.{jpeg,jpg,png,gif}",
);

// IMPORTANTE: Convertimos el map en una serie de promesas para resolver las imágenes
const mediumPacksWithImages = await Promise.all(
  productsData
    .filter((item) => item.size == "mediano")
    .map(async (item) => {
      const imageModule = await images[item.img]();
      return { ...item, imageResolved: imageModule.default };
    }),
);
---

<section>
  <div class="mb-8 flex flex-col items-center text-center">
    <h3
      class="flex items-center gap-2 text-2xl font-bold tracking-tight text-[#1d0c0e] sm:text-3xl"
    >
      DAILY <span class="text-orange-400">☀️</span>
    </h3>
    <p class="text-primary font-medium">La mejor forma de empezar el día.</p>
  </div>
  <div class="swiper morningSwiper !pb-12 !px-1">
    <div class="swiper-wrapper">
      {
        mediumPacksWithImages.map((el) => {
          return (
            <div class="swiper-slide !h-auto">
              <div class="group flex flex-col h-full overflow-hidden rounded-2xl bg-surface-light shadow-md border-2 border-gold/30 hover:shadow-pop-hover transition-all duration-300">
                <div class="aspect-square xl:aspect-video w-full overflow-hidden bg-gray-100">
                  <Picture
                    src={el.imageResolved}
                    alt={"media"}
                    formats={["webp", "png"]}
                    widths={[400, 800]}
                    sizes="(max-width: 800px) 100vw, 800px"
                    class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
                  />
                </div>
                <div class="flex flex-1 flex-col p-6">
                  {/* <div class="mb-3 flex gap-2">
                    <span class="flex items-center justify-center rounded-full bg-orange-100 p-1.5 text-orange-600 dark:bg-orange-900/30 dark:text-orange-300">
                      <span class="material-symbols-outlined text-[16px]">
                        bakery_dining
                      </span>
                    </span>
                    <span class="flex items-center justify-center rounded-full bg-orange-100 p-1.5 text-orange-600 dark:bg-orange-900/30 dark:text-orange-300">
                      <span class="material-symbols-outlined text-[16px]">
                        local_cafe
                      </span>
                    </span>
                    <span class="flex items-center justify-center rounded-full bg-orange-100 p-1.5 text-orange-600 dark:bg-orange-900/30 dark:text-orange-300">
                      <span class="material-symbols-outlined text-[16px]">
                        nutrition
                      </span>
                    </span>
                  </div> */}
                  <h4 class="mb-2 text-xl font-bold text-gray-900">
                    {el.name}
                  </h4>
                  <ul class="mb-4 text-sm text-gray-600 list-disc ml-4">
                    {el.content.map((el) => {
                      return <li>{el}</li>;
                    })}
                  </ul>
                  <div class="mt-auto flex items-center justify-between gap-4 border-t border-gray-100 pt-4">
                    <span class="text-xl font-bold text-[#1d0c0e]">
                      {el.price.toLocaleString("es-MX", {
                        currency: "MXN",
                        style: "currency",
                      })}
                    </span>
                    <button
                      data-item-id={el.id}
                      data-item-name={el.name}
                      data-item-image={el.imageResolved.src}
                      data-item-price={el.price}
                      class="add-to-cart cursor-pointer flex items-center gap-2 rounded-lg bg-whatsapp px-6 py-2.5 text-sm font-bold text-white transition-transform group-hover:scale-105 group-hover:bg-whatsapp-hover"
                    >
                      <span class="material-symbols-outlined text-[18px]">
                        chat
                      </span>
                      LO QUIERO
                    </button>
                  </div>
                </div>
              </div>
            </div>
          );
        })
      }
    </div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-next hidden sm:flex"></div>
    <div class="swiper-button-prev hidden sm:flex"></div>
  </div>
</section>
<script>
  import Swiper from "swiper";
  import { Pagination, Navigation } from "swiper/modules";
  import { addCartItem, isCartOpen } from "../atoms/cardStore";

  document.addEventListener("DOMContentLoaded", function () {
    // Morning Vibes Swiper
    new Swiper(".morningSwiper", {
      modules: [Pagination, Navigation],
      slidesPerView: 1,
      spaceBetween: 20,
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      breakpoints: {
        768: {
          slidesPerView: 2,
          spaceBetween: 24,
        },
      },
    });
  });
</script>
