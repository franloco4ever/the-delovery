---
import productsData from "../data/paquetes.json";

const smallPacks = productsData.filter((item) => item.size == "chico");

import "swiper/css/navigation";
import "swiper/css/pagination";
---

<section>
  <div class="mb-8 flex flex-col items-center text-center">
    <h3
      class="flex items-center gap-2 text-2xl font-bold tracking-tight text-[#1d0c0e] dark:text-white sm:text-3xl"
    >
      JOY DROPS <span class="text-blue-400">üíß</span>
    </h3>
    <p class="text-primary font-medium">
      Detalles peque√±os, sonrisas gigantes.
    </p>
  </div>

  <div class="swiper joySwiper !pb-12 !px-1">
    <div class="swiper-wrapper !h-auto">
      {
        smallPacks.map((el) => {
          return (
            <div class="swiper-slide !h-auto">
              <div class="group relative flex flex-col h-full overflow-hidden rounded-xl bg-surface-light dark:bg-surface-dark shadow-sm hover:shadow-pop transition-all border border-gray-100 dark:border-gray-700">
                <div class="aspect-square w-full overflow-hidden bg-gray-200">
                  <img
                    alt="media"
                    class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-110"
                    src={el.img}
                  />
                </div>
                <div class="flex flex-1 flex-col p-4">
                  {/* <div class="mb-2 flex flex-wrap gap-1">
                    <span class="inline-flex items-center rounded-md bg-teal-accent/10 px-1.5 py-0.5 text-[10px] font-bold text-teal-700 dark:text-teal-300">
                      üç™ Cookies
                    </span>
                    <span class="inline-flex items-center rounded-md bg-teal-accent/10 px-1.5 py-0.5 text-[10px] font-bold text-teal-700 dark:text-teal-300">
                      ü•õ Milk
                    </span>
                  </div> */}
                  <h4 class="mb-1 text-lg font-bold leading-tight text-gray-900 dark:text-white first-letter:capitalize">
                    {el.name}
                  </h4>
                  <ul class="mb-4 text-sm text-gray-600 dark:text-gray-300 list-disc ml-4">
                    {el.content.map((el) => {
                      return <li>{el}</li>;
                    })}
                  </ul>
                  <p class="mb-4 text-sm font-semibold text-gray-500 dark:text-gray-400">
                    ${el.price} MXN
                  </p>
                  <button
                    data-item-id={el.id}
                    data-item-name={el.name}
                    data-item-image={el.img}
                    class="add-to-cart cursor-pointer mt-auto flex w-full items-center justify-center gap-2 rounded-lg bg-whatsapp py-2.5 text-sm font-bold text-white transition-colors group-hover:bg-whatsapp-hover"
                  >
                    <span class="material-symbols-outlined text-[18px]">
                      chat
                    </span>
                    LO QUIERO
                  </button>
                </div>
              </div>
            </div>
          );
        })
      }
    </div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-next hidden sm:flex"></div>
    <div class="swiper-button-prev hidden sm:flex"></div>
  </div>
</section>
<script>
  import Swiper from "swiper";
  import { Pagination, Navigation, Autoplay } from "swiper/modules";
  import { addCartItem, isCartOpen } from "../atoms/cardStore";

  document.addEventListener("DOMContentLoaded", function () {
    // Joy Drops Swiper
    new Swiper(".joySwiper", {
      modules: [Pagination, Navigation, Autoplay],
      slidesPerView: 1,
      spaceBetween: 20,
      autoplay: {
        disableOnInteraction: true,
        delay: 4000,
      },
      pagination: {
        el: ".swiper-pagination",
        clickable: true,
      },
      navigation: {
        nextEl: ".swiper-button-next",
        prevEl: ".swiper-button-prev",
      },
      breakpoints: {
        640: {
          slidesPerView: 2,
          spaceBetween: 20,
        },
        1024: {
          slidesPerView: 4,
          spaceBetween: 20,
        },
      },
    });
  });

  // Agregar event listeners a los botones
  const addToCartButtons = document.querySelectorAll(".add-to-cart");

  addToCartButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
      const btn = e.currentTarget as HTMLButtonElement;
      const itemId = btn.dataset.itemId;
      const itemName = btn.dataset.itemName;
      const itemImage = btn.dataset.itemImage;

      if (itemId && itemName && itemImage) {
        addCartItem({
          id: itemId,
          name: itemName,
          imageSrc: itemImage,
        });

        // Opcional: Abrir el carrito autom√°ticamente
        isCartOpen.set(true);

        // Opcional: Feedback visual
        btn.textContent = "¬°AGREGADO!";
        setTimeout(() => {
          btn.innerHTML = `<span class="material-symbols-outlined text-[18px]">chat</span> LO QUIERO`;
        }, 1000);
      }
    });
  });
</script>
